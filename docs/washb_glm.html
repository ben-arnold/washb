<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>washb_glm. washb 0.2.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="index.html">washb 0.2.1</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="reference.html">Reference</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <div class="container">
      <header>
        
      </header>
      
      <h1>Generalized linear model function for the WASH Benefits study</h1>

<div class="row">
  <div class="span8">
    <h2>Usage</h2>
    <pre><span class="functioncall"><a href='washb_glm.html'>washb_glm</a></span><span class="keyword">(</span><span class="symbol">Y</span><span class="keyword">,</span><span class="symbol">tr</span><span class="keyword">,</span><span class="symbol">pair</span><span class="keyword">,</span><span class="argument">W</span><span class="argument">=</span>NULL<span class="keyword">,</span> <span class="argument">forcedW</span><span class="argument">=</span>NULL<span class="keyword">,</span> <span class="argument">V</span><span class="argument">=</span>NULL<span class="keyword">,</span> <span class="symbol">id</span><span class="keyword">,</span><span class="symbol">contrast</span><span class="keyword">,</span><span class="argument">family</span><span class="argument">=</span><span class="string">"gaussian"</span><span class="keyword">,</span> <span class="argument">pval</span><span class="argument">=</span><span class="number">0.2</span><span class="keyword">,</span> <span class="argument">print</span><span class="argument">=</span><span class="number">TRUE</span><span class="keyword">)</span></pre>
    
    <h2>Arguments</h2>
    <dl>
      <dt>Y</dt>
      <dd>Outcome variable (continuous, such as LAZ, or binary, such as diarrhea)</dd>
      <dt>tr</dt>
      <dd>Binary treatment group variable (ideally a factor), comparison group first</dd>
      <dt>pair</dt>
      <dd>Pair-matched randomization ID variable (in WASH Benefits: block)</dd>
      <dt>W</dt>
      <dd>Optional data frame that includes adjustment covariates (for adjusted estimates)</dd>
      <dt>forcedW</dt>
      <dd>Optional vector of variable names to force as adjustment covariates (no screening)</dd>
      <dt>V</dt>
      <dd>Optional variable name for subgroup analyses, which is interacted with &#39;tr&#39;.</dd>
      <dt>id</dt>
      <dd>ID variable for independent units (cluster ID)</dd>
      <dt>contrast</dt>
      <dd>Vector of length 2 that includes the groups to contrast, e.g., c(&quot;Control&quot;,&quot;Water&quot;)</dd>
      <dt>family</dt>
      <dd>GLM model family (gaussian, binomial, poisson, and negative binomial). Use &quot;binonial(link=&#39;log&#39;)&quot; to return prevalence ratios instead of odds ratios when the outcome is binary.  Use &quot;neg.binom&quot; for a Negative binomial model.</dd>
      <dt>pval</dt>
      <dd>The p-value threshold: any variables with a p-value from the lielihood ratio test below this threshold will be returned. Defaults to 0.2</dd>
      <dt>print</dt>
      <dd>Logical for whether to print function output, defaults to TRUE.</dd>
      <dt>verbose</dt>
      <dd>Logical for whether to print names and descriptions of returned list objects</dd>
    </dl>
    
    <div class="Value">
      <h2>Value</h2>

      <p><dl>
Returns a list of the risk ratios or risk differences, the variance-covariance matrix, and a vector indexing the rows of observations
        used to fit the glm model
</dl></p>

    </div>

    <div class="Description">
      <h2>Description</h2>

      <p>Estimate intention-to-treat parameters with generalized linear models and robust standard errors</p>

    </div>

    <div class="Details">
      <h2>Details</h2>

      <p><code>washb_glm</code> fits a generalized linear model to estimate intention-to-treat (ITT) effects in a trial. The <code>contrast</code> argument enables you to specify the arms that you wish to compare (reference group in the first argument, comparison group in the second). To estimate adjusted effects, you can pass a data.frame of adjustment covariates to the <code>W</code> argument -- by default, covariates are pre-screened to only include those that are associated with the outcome based on a likelihood ratio test. To over-ride the pre-screening algorithm for some or all covariates, use the <code>forcedW</code> argment.</p>

      <p>If the design is pair-matched (all primary outcome analyses in WASH B should be pair matched), use the <code>pair</code> argument to specify an id variable for pairs, and specify the same variable in the id argument to get correct SEs. If the design is not pair-matched, then the id argument should identify the smallest independent unit in the trial (e.g., cluster). The function computes robust standard errors. Note that this function automatically drops observations from the analysis if they are from a pair with no treatment contrast -- this can happen with incomplete randomization blocks in the Kenya trial.</p>

      <p>Note that for binary outcomes such as diarrhea, the glm model is fit with a log link,
 <code>family=binomial(link=&#39;log&#39;)</code>, to estimate prevalence ratios rather than the canonical logit link, <code>family=&#39;binomial&#39;</code>,
 to estimate the odds ratio. Occasionally, a glm model with a non-canonical link function like <code>family=binomial(link=&#39;log&#39;)</code> will fail to converge, particularly if the data are sparse.
 If this occurs, use a modified poisson regression to estimate prevalence ratio using the argument <code>family=poisson(link=&#39;log&#39;)</code>.
 See Zou 2004 (https://www.ncbi.nlm.nih.gov/pubmed/15033648) for details.</p>

      <p>The function also makes it straight forward to estimate conditional (i.e., subgroup) effects using the optional <code>V</code> argument.</p>

    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'>
<span class="comment">#washb_glm function applied to the Bangladesh diarrheal disease outcome to determine both unadjusted and adjusted</span>
<span class="comment">#prevalence ratios between intervention and control arms.</span>


<span class="comment">#Cleans and merge the enrollment and diarrhea data:</span>
<span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/library'>library</a></span><span class="keyword">(</span><span class="symbol">washb</span><span class="keyword">)</span>
<span class="functioncall"><a href='http://www.rdocumentation.org/packages/utils/topics/data'>data</a></span><span class="keyword">(</span><span class="symbol">washb_bd_enrol</span><span class="keyword">)</span></div>
<strong class='warning'>Warning message:
data set ‘washb_bd_enrol’ not found</strong>
<div class='input'><span class="functioncall"><a href='http://www.rdocumentation.org/packages/utils/topics/data'>data</a></span><span class="keyword">(</span><span class="symbol">washb_bd_diar</span><span class="keyword">)</span></div>
<strong class='warning'>Warning message:
data set ‘washb_bd_diar’ not found</strong>
<div class='input'>
<span class="comment"># drop svydate and month because they are superceded in the child level diarrhea data</span>
<span class="comment">#washb_bd_enrol$svydate &lt;- NULL</span>
<span class="comment">#washb_bd_enrol$month &lt;- NULL</span>

<span class="comment"># merge the baseline dataset to the follow-up dataset</span>
<span class="symbol">ad</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/merge'>merge</a></span><span class="keyword">(</span><span class="symbol">washb_bd_enrol</span><span class="keyword">,</span><span class="symbol">washb_bd_diar</span><span class="keyword">,</span><span class="argument">by</span><span class="argument">=</span><span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"dataid"</span><span class="keyword">,</span><span class="string">"clusterid"</span><span class="keyword">,</span><span class="string">"block"</span><span class="keyword">,</span><span class="string">"tr"</span><span class="keyword">)</span><span class="keyword">,</span><span class="argument">all.x</span><span class="argument">=</span><span class="symbol">F</span><span class="keyword">,</span><span class="argument">all.y</span><span class="argument">=</span><span class="symbol">T</span><span class="keyword">)</span></div>
<strong class='error'>Error in fix.by(by.x, x): &#39;by&#39; must specify a uniquely valid column</strong>
<div class='input'>
<span class="comment"># subset to the relevant measurement</span>
<span class="comment"># Year 1 or Year 2</span>
<span class="symbol">ad</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/subset'>subset</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">,</span><span class="symbol">svy</span>==<span class="number">1</span><span class="keyword">|</span><span class="symbol">svy</span>==<span class="number">2</span><span class="keyword">)</span></div>
<strong class='error'>Error in subset(ad, svy == 1 | svy == 2): object &#39;ad&#39; not found</strong>
<div class='input'>
<span class="comment">#subset the diarrhea to children &lt;36 mos at enrollment</span>
<span class="comment">### (exlude new births that are not target children)</span>
<span class="symbol">ad</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/subset'>subset</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">,</span><span class="symbol">sibnewbirth</span>==<span class="number">0</span><span class="keyword">)</span></div>
<strong class='error'>Error in subset(ad, sibnewbirth == 0): object &#39;ad&#39; not found</strong>
<div class='input'><span class="symbol">ad</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/subset'>subset</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">,</span><span class="symbol">gt36mos</span>==<span class="number">0</span><span class="keyword">)</span></div>
<strong class='error'>Error in subset(ad, gt36mos == 0): object &#39;ad&#39; not found</strong>
<div class='input'>
<span class="comment"># Exclude children with missing data</span>
<span class="symbol">ad</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/subset'>subset</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">,</span><span class="keyword">!</span><span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/NA'>is.na</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">diar7d</span><span class="keyword">)</span><span class="keyword">)</span></div>
<strong class='error'>Error in subset(ad, !is.na(ad$diar7d)): object &#39;ad&#39; not found</strong>
<div class='input'>
<span class="comment">#Re-order the tr factor for convenience</span>
<span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">tr</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">tr</span><span class="keyword">,</span><span class="argument">levels</span><span class="argument">=</span><span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"Water"</span><span class="keyword">,</span><span class="string">"Sanitation"</span><span class="keyword">,</span><span class="string">"Handwashing"</span><span class="keyword">,</span><span class="string">"WSH"</span><span class="keyword">,</span><span class="string">"Nutrition"</span><span class="keyword">,</span><span class="string">"Nutrition + WSH"</span><span class="keyword">)</span><span class="keyword">)</span></div>
<strong class='error'>Error in factor(ad$tr, levels = c(&quot;Control&quot;, &quot;Water&quot;, &quot;Sanitation&quot;, &quot;Handwashing&quot;,     &quot;WSH&quot;, &quot;Nutrition&quot;, &quot;Nutrition + WSH&quot;)): object &#39;ad&#39; not found</strong>
<div class='input'>
<span class="comment">#Ensure that month is coded as a factor</span>
<span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">month</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">month</span><span class="keyword">)</span></div>
<strong class='error'>Error in factor(ad$month): object &#39;ad&#39; not found</strong>
<div class='input'>
<span class="comment">#Sort the data for perfect replication when using V-fold cross-validation</span>
<span class="symbol">ad</span> <span class="assignement">&lt;-</span> <span class="symbol">ad</span><span class="keyword">[</span><span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/order'>order</a></span><span class="keyword">(</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">block</span><span class="keyword">,</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">clusterid</span><span class="keyword">,</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">dataid</span><span class="keyword">,</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">childid</span><span class="keyword">)</span><span class="keyword">,</span><span class="keyword">]</span></div>
<strong class='error'>Error in eval(expr, envir, enclos): object &#39;ad&#39; not found</strong>
<div class='input'>
<span class="comment">###Create vector of contrasts for each hypothesis to facilitate comparisons between arms.</span>
<span class="comment">#Hypothesis 1: Each intervention arm vs. Control</span>
<span class="symbol">h1.contrasts</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/list'>list</a></span><span class="keyword">(</span>
  <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"Water"</span><span class="keyword">)</span><span class="keyword">,</span>
  <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"Sanitation"</span><span class="keyword">)</span><span class="keyword">,</span>
  <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"Handwashing"</span><span class="keyword">)</span><span class="keyword">,</span>
  <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"WSH"</span><span class="keyword">)</span><span class="keyword">,</span>
  <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"Nutrition"</span><span class="keyword">)</span><span class="keyword">,</span>
  <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"Nutrition + WSH"</span><span class="keyword">)</span>
<span class="keyword">)</span>



<span class="comment">###Unadjusted GLM estimates for diarrheal disease outcome.</span>
<span class="comment">#As an example, the following code applies the washb_glm function to compare 7-day recall diarrheal disease prevalence between the sanitation and control arms. Notice that the glm model is fit with a log link, `family=binomial(link='log')`, to estimate prevalence ratios rather than with a logit link, `family="binomial"`, to estimate the odds ratio.</span>

<span class="symbol">Diar.glm.C.S</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='washb_glm.html'>washb_glm</a></span><span class="keyword">(</span><span class="argument">Y</span><span class="argument">=</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">diar7d</span><span class="keyword">,</span><span class="argument">tr</span><span class="argument">=</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">tr</span><span class="keyword">,</span><span class="argument">pair</span><span class="argument">=</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">block</span><span class="keyword">,</span> <span class="argument">id</span><span class="argument">=</span><span class="symbol">ad</span><span class="keyword">$</span><span class="symbol">clusterid</span><span class="keyword">,</span> <span class="argument">contrast</span><span class="argument">=</span><span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"Control"</span><span class="keyword">,</span><span class="string">"Sanitation"</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">family</span><span class="argument">=</span><span class="functioncall"><a href='http://www.rdocumentation.org/packages/stats/topics/family'>binomial</a></span><span class="keyword">(</span><span class="argument">link</span><span class="argument">=</span><span class="string">'log'</span><span class="keyword">)</span><span class="keyword">)</span></div>
<strong class='error'>Error in washb_glm(Y = ad$diar7d, tr = ad$tr, pair = ad$block, id = ad$clusterid,     contrast = c(&quot;Control&quot;, &quot;Sanitation&quot;), family = binomial(link = &quot;log&quot;)): object &#39;ad&#39; not found</strong>
<div class='input'>
<span class="comment">#On top of the function's auto-printed output, the washb_glm function contains a number of objects. For example, `'objectname'$vcv` returns the variance-covariance matrix.</span>


<span class="comment">#All returned objects are:</span>
<span class="comment">#'objectname$fit` to return full glm model estimates.</span>
<span class="comment">#'objectname$vcv` to return the variance-covariance matrix.</span>
<span class="comment">#'objectname$rowdropped` to return the vector list of observations included in the model fit.</span>
<span class="comment">#'objectname$lincom` to return subgroup-specific conditional relative risk estimates if a subgroup V is specified.</span></div></pre>
  </div>
  <div class="span4 sidebar">
    <!-- <ul>
      <li>washb_glm</li>
    </ul>
    <ul>
      
    </ul> -->




  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="https://getbootstrap.com/2.0.4/">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>