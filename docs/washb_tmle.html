<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>washb_tmle. washb 0.1.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="index.html">washb 0.1.1</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="reference.html">Reference</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <div class="container">
      <header>
        
      </header>
      
      <h1>Target maximum likelihood estimation of intention-to-treat effects in the WASH Benefits trials</h1>

<div class="row">
  <div class="span8">
    <h2>Usage</h2>
    <pre><span class="functioncall"><a href='washb_tmle.html'>washb_tmle</a></span><span class="keyword">(</span><span class="symbol">Y</span><span class="keyword">,</span> <span class="symbol">tr</span><span class="keyword">,</span> <span class="argument">W</span>&nbsp;<span class="argument">=</span>&nbsp;NULL<span class="keyword">,</span> <span class="argument">id</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">1</span><span class="keyword">:</span><span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/length'>length</a></span><span class="keyword">(</span><span class="symbol">Y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">pair</span>&nbsp;<span class="argument">=</span>&nbsp;NULL<span class="keyword">,</span>
  <span class="argument">Delta</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span><span class="keyword">(</span><span class="number">1</span><span class="keyword">,</span> <span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/length'>length</a></span><span class="keyword">(</span><span class="symbol">Y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="argument">family</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="string">"gaussian"</span><span class="keyword">,</span> <span class="symbol">contrast</span><span class="keyword">,</span>
  <span class="argument">Q.SL.library</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"SL.mean"</span><span class="keyword">,</span> <span class="string">"SL.glm"</span><span class="keyword">,</span> <span class="string">"SL.bayesglm"</span><span class="keyword">,</span> <span class="string">"SL.gam"</span><span class="keyword">,</span> <span class="string">"SL.glmnet"</span><span class="keyword">)</span><span class="keyword">,</span>
  <span class="argument">g.SL.library</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="symbol">Q.SL.library</span><span class="keyword">,</span> <span class="argument">pval</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">0.2</span><span class="keyword">,</span> <span class="argument">seed</span>&nbsp;<span class="argument">=</span>&nbsp;NULL<span class="keyword">,</span> <span class="argument">print</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">TRUE</span><span class="keyword">)</span></pre>
    
    <h2>Arguments</h2>
    <dl>
      <dt>Y</dt>
      <dd>Outcome variable (continuous, such as LAZ, or binary, such as diarrhea)</dd>
      <dt>tr</dt>
      <dd>Binary treatment group variable, comparison group first</dd>
      <dt>W</dt>
      <dd>Data frame that includes adjustment covariates</dd>
      <dt>id</dt>
      <dd>ID variable for independent units. For pair-matched designs, this is the matched pair and should be the same as the <code>pair</code> argument. For analyses that are not pair-matched, then it should typically be the cluster.</dd>
      <dt>pair</dt>
      <dd>An optional ID variable to identify the matched pair unit (In WASH Benefits, blocks) if conducting a matched-pair analysis. This argument is used to drop pairs that are missing one or more treatment groups. Incomplete pairs is not an issue in the overall Bangladesh trial (there were no incomplete blocks), but is an issue in the Kenya trial where there were some incomplete blocks.</dd>
      <dt>Delta</dt>
      <dd>indicator of missing outcome. 1 - observed, 0 - missing.</dd>
      <dt>family</dt>
      <dd>Outcome family: <code>gaussian</code> (continuous outcomes, like LAZ) or <code>binomial</code> (binary outcomes like diarrhea or stunting)</dd>
      <dt>contrast</dt>
      <dd>Vector of length 2 that includes the treatment groups to contrast (e.g., <code>contrast=c(&#39;Control&#39;,&#39;Nutrition&#39;)</code>).</dd>
      <dt>g.SL.library</dt>
      <dd>Library of algorithms to include in the SuperLearner for the treatment model Pr(A|W) (ignored if prtr is specified), and for the missingness model Pr(Delta|A,W) (if Delta is specified)</dd>
      <dt>pval</dt>
      <dd>The p-value threshold used to pre-screen covariates (<code>W</code>) based on a likelihood ratio test in a univariate regression with the outcome (<code>Y</code>). Variables with a univariate association p-value below this threshold will be used in the final model. Defaults to 0.2.</dd>
      <dt>seed</dt>
      <dd>A seed for the pseudo-random cross-validation split used in model selection (use for perfectly reproducible results).</dd>
      <dt>print</dt>
      <dd>Logical for printed output, defaults to true. If false, no output will be printed to the console if the returned object is saved to an R object.</dd>
      <dt>Q.SL.Library</dt>
      <dd>Library of algorithms to include in the SuperLearner for the outcome model</dd>
    </dl>
    
    <div class="Value">
      <h2>Value</h2>

      <p><dl>
A <code>tmle()</code> fit object (see the <code><a href='http://www.rdocumentation.org/packages/tmle/topics/tmle'>tmle</a></code> package for details). The <code>$estimates</code> list includes parameter estimates along with variance estimates and confidence intervals.
</dl></p>

    </div>

    <div class="Description">
      <h2>Description</h2>

      <p>Estimate intention-to-treat parameters using targeted maximum likelihood estimation (TMLE), potentially adjusted for covariates and missing outcomes</p>

    </div>

    <div class="Details">
      <h2>Details</h2>

      <p>The <code>washb_tmle</code> function is mainly a convenience wrapper for the <code><a href='http://www.rdocumentation.org/packages/tmle/topics/tmle'>tmle</a></code> function. It estimates intention-to-treat effects in a trial using targeted maximum likelihood estimation (TMLE). In brief, the function does the following: it restricts the data to complete observations in the two arms listed in the <code>contrast</code> argument, it pre-screens covariates (<code>W</code>), if specified, to select those that have a univariate association with the outcome, and then it estimates the intention-to-treat effect using TMLE.  If <code>family=&#39;binomial&#39;</code>, then the function returns effects on the absolute, relative, and odds ratio scale. If <code>Delta</code> is specified (i.e., observations with missing outcomes are included), then the function will adjust the effects for missingness using inverse probability of censoring weights, with the weights estimated using super learning of <code>Pr(Delta|A,W)</code>.</p>

      <p>If the analysis is pair-matched (as for primary outcomes), be sure to specify the pair ID in the <code>id</code> argument. Do not include pair IDs in the adjustment covariate set.</p>

      <p>If adjustment covariates (<code>W</code>) are specified, then by default they are pre-screened and the subset that is associated with the outcome based on a likelihood ratio test are used in the estimation. There are some other important defaults to be aware of. First, the <code>washb_tmle</code> function estimates the treatment mechanism even though it is a randomized trial. There are two reasons for this -- one theoretical and one practical. The theoretical reason is that estimating the treatment mechanism gains efficiency (see Balzer et al. 2016); the practical reason is that unless the analysis is conducted at the cluster level (i.e., providing cluster means to the <code>washb_tmle</code> function), then the empirical treatment probabilities differ slightly due to varying cluster sizes. Estimating the treatment mechanism ensures that the variance calculation correctly accounts for the empirical treatment probabilities in the data.</p>

      <p>Another default is that <code>washb_tmle</code> uses the <code><a href='http://www.rdocumentation.org/packages/SuperLearner/topics/SuperLearner'>SuperLearner</a></code> algorithm to adjust for covariates and to predict the treatment mechanism and censoring mechanism (if adjusting for missing outcomes). The default algorithm library includes the simple mean, main terms GLM, main terms Bayes GLM with non-informative priors, generalized additive models (degree 2), and lasso (glmnet). These are the pre-specified algorithms from the original trial statistical analysis plan. You can type <code>listWrappers()</code> to see the full set of algorithms implemented in the super learner. If you just wish to use a main effects GLM model to adjust for the covariates, then you can specify <code>Q.SL.library=&quot;SL.glm&quot;</code>.  If you are dealing with very small sample sizes (e.g., in a substudy), then you may wish to use even simpler libraries, such as a set of univariate regressions (as in Balzer et al. 2016).</p>

      <p>Finally, by default the function uses the same algorithm library to predict the outcome (<code>Q.SL.library</code>) and the treatment and censoring mechanisms (<code>g.SL.library</code>). You can specify a different library for the treatment and censoring mechanisms using the <code>g.SL.library</code> argument.</p>

      <p>If you want to adjust for missing outcomes in the analysis, then you need to include observations that have a missing outcome (<code>Y</code>) with <code>Delta=0</code> for those observations. Observations with missing outcomes should have treatment (<code>tr</code>) and covariate (<code>W</code>) information, which are used to create weights for <code>Pr(Delta|A,W)</code>.</p>

      <p>Note: this function depends on the <code><a href='http://www.rdocumentation.org/packages/tmle/topics/tmle'>tmle</a></code> package, the <code><a href='http://www.rdocumentation.org/packages/SuperLearner/topics/SuperLearner'>SuperLearner</a></code> package, as well as the internal washb_prescreen() and design_matrix() functions.</p>

    </div>

    <div class="References">
      <h2>References</h2>

      <p>Gruber S, van der Laan M. tmle: An R Package for Targeted Maximum Likelihood Estimation. J Stat Softw. 2012;51: 1â€“35. (https://www.jstatsoft.org/article/view/v051i13)</p>

      <p>Balzer LB, van der Laan MJ, Petersen ML, SEARCH Collaboration. Adaptive pre-specification in randomized trials with and without pair-matching. Stat Med. 2016; doi:10.1002/sim.7023 (http://onlinelibrary.wiley.com/doi/10.1002/sim.7023/abstract)</p>

    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'><span class="comment">#TBD</span></div></pre>
  </div>
  <div class="span4 sidebar">
    <!-- <ul>
      <li>washb_tmle</li>
    </ul>
    <ul>
      
    </ul> -->




  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="https://getbootstrap.com/2.0.4/">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>