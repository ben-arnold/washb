<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Conditional permutation test using the Wilcoxon signed rank statistic in the WASH Benefits trials — washb_permute • washb</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Conditional permutation test using the Wilcoxon signed rank statistic in the WASH Benefits trials — washb_permute" />

<meta property="og:description" content="WASH Benefits Wilcoxon Signed Rank permutation test function for two treatment arms conditional on randomization block.
Conducts a permutation test of the independence of Y and tr, conditional on randomization block using the Wilcoxon rank-sum test statistic." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">washb</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/washb.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Conditional permutation test using the Wilcoxon signed rank statistic in the WASH Benefits trials</h1>
    
    <div class="hidden name"><code>washb_permute.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>WASH Benefits Wilcoxon Signed Rank permutation test function for two treatment arms conditional on randomization block.
Conducts a permutation test of the independence of Y and tr, conditional on randomization block using the Wilcoxon rank-sum test statistic.</p>
    
    </div>

    <pre class="usage"><span class='fu'>washb_permute</span>(<span class='no'>Y</span>,<span class='no'>tr</span>,<span class='no'>pair</span>,<span class='no'>contrast</span>,<span class='kw'>nreps</span><span class='kw'>=</span><span class='fl'>100000</span>,<span class='kw'>seed</span><span class='kw'>=</span><span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>Outcome variable (continuous, such as LAZ, or binary, such as diarrhea)</p></td>
    </tr>
    <tr>
      <th>tr</th>
      <td><p>Binary treatment group variable (ideally a factor), comparison group first</p></td>
    </tr>
    <tr>
      <th>pair</th>
      <td><p>Pair-matched randomization ID variable (in WASH Benefits: block)</p></td>
    </tr>
    <tr>
      <th>contrast</th>
      <td><p>Vector of length 2 that includes the groups to contrast, e.g., c("Control","Water")</p></td>
    </tr>
    <tr>
      <th>nreps</th>
      <td><p>Number of permutations to run.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>Number for psuedo-random number generation in R</p></td>
    </tr>
    <tr>
      <th>print</th>
      <td><p>If print==FALSE, suppress printed output.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of four slices (replace "~" with the assigned object name):
~$p.value  The permutation test p-value
~$Z  The z-statistic
~$Ho
~$W The full output of the wilcoxsign_test function called within the washb_permute function.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>washb_glm</code> and <code>washb_tmle</code> related functions enable us to test hypotheses about whether the average outcome differs between trial arms -- that is,
whether the difference in means is equal to zero.  The mean is just one function of the outcome distribution. A sharper test is the “sharp null hypothesis”
first proposed by Ronald Fisher, in which we test whether there is any difference at all in the outcome distributions between intervention arms. Under the
null hypothesis of no treatment effect, the outcome distributions should be indistinguishable from random sampling variation. A way to test the sharp null
hypothesis is with a permutation test (also called a Fisher randomization test). The intuition behind the test is that there is a single source of random
variation in the trial: namely the random allocation of treatment. If we re-randomize treatment in every possible combination (or a very large number of combinations),
and compare arms using a test statistic for each combination, then this provides us with the test statistic’s distribution under the null hypothesis of no effect
(since we re-shuffle treatment in each iteration, it is completely uninformative).  We can then compare the observed test statistic with real group assignments
to the null distribution to see how likely it would be to have occurred by chance.  For more details on randomization tests, see the references below.</p>
<p>In the WASH Benefits primary analysis, we pre-specified that we would test this sharp null using a Wilcoxon signed rank test, which is a non-parametric test
statistic has been shown to have good power against alternatives for outcomes that could potentially have skewed distributions [Imbens GW, Rubin DB. Causal
Inference in Statistics, Social, and Biomedical Sciences. Cambridge University Press; 2015.](http://dl.acm.org/citation.cfm?id=2764565).</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>1.	Gail, M. H., Mark, S. D., Carroll, R. J., Green, S. B. &amp; Pee, D. On Design Considerations and Randomization-Based Inference for Community Intervention Trials. Statist. Med. 15, 1069–1092 (1996).
[Link](http://onlinelibrary.wiley.com/doi/10.1002/(SICI)1097-0258(19960615)15:11<!-- %3c1069::AID-SIM220%3e3.0.CO%3b2-Q/full) -->
2.	Braun, T. M. &amp; Feng, Z. Optimal Permutation Tests for the Analysis of Group Randomized Trials. Journal of the American Statistical Association 96, 1424–1432 (2001).
[Link](http://www.tandfonline.com/doi/abs/10.1198/016214501753382336)
3.	Rosenbaum, P. R. Covariance Adjustment in Randomized Experiments and Observational Studies. Statist. Sci. 17, 286–327 (2002).
[Link](http://projecteuclid.org/euclid.ss/1042727942)</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#Unadjusted permutation test of Bangladesh diarrheal disease primary outcome</span>

<span class='co'>#######################</span>
<span class='co'>#Load and clean data</span>
<span class='co'>#######################</span>
<span class='fu'>data</span>(<span class='no'>washb_bangladesh_diar</span>)
<span class='no'>washb_bangladesh_diar</span> <span class='kw'>&lt;-</span> <span class='no'>washb_bangladesh_diar</span>

<span class='fu'>data</span>(<span class='no'>washb_bangladesh_enrol</span>)
<span class='no'>washb_bangladesh_enrol</span> <span class='kw'>&lt;-</span> <span class='no'>washb_bangladesh_enrol</span>

 <span class='co'># drop svydate and month because they are superceded in the child level diarrhea data</span>
<span class='no'>washb_bangladesh_enrol</span>$<span class='no'>svydate</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='no'>washb_bangladesh_enrol</span>$<span class='no'>month</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>

<span class='co'># merge the baseline dataset to the follow-up dataset</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>merge</span>(<span class='no'>washb_bangladesh_enrol</span>,<span class='no'>washb_bangladesh_diar</span>,<span class='kw'>by</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"dataid"</span>,<span class='st'>"clusterid"</span>,<span class='st'>"block"</span>,<span class='st'>"tr"</span>),<span class='kw'>all.x</span><span class='kw'>=</span><span class='fl'>FALSE</span>,<span class='kw'>all.y</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'># subset to the relevant measurement</span>
<span class='co'># Year 1 or Year 2</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,<span class='no'>svy</span><span class='kw'>==</span><span class='fl'>1</span><span class='kw'>|</span><span class='no'>svy</span><span class='kw'>==</span><span class='fl'>2</span>)

<span class='co'>#subset the diarrhea to children &lt;36 mos at enrollment</span>
<span class='co'>### (exlude new births that are not target children)</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,<span class='no'>sibnewbirth</span><span class='kw'>==</span><span class='fl'>0</span>)
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,<span class='no'>gt36mos</span><span class='kw'>==</span><span class='fl'>0</span>)

<span class='co'># Exclude children with missing data</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,!<span class='fu'>is.na</span>(<span class='no'>ad</span>$<span class='no'>diar7d</span>))

<span class='co'>#Re-order the tr factor for convenience</span>
<span class='no'>ad</span>$<span class='no'>tr</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>levels</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Water"</span>,<span class='st'>"Sanitation"</span>,<span class='st'>"Handwashing"</span>,<span class='st'>"WSH"</span>,<span class='st'>"Nutrition"</span>,<span class='st'>"Nutrition + WSH"</span>))

<span class='co'>#Ensure that month is coded as a factor</span>
<span class='no'>ad</span>$<span class='no'>month</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>ad</span>$<span class='no'>month</span>)

<span class='co'>#Sort the data for perfect replication when using V-fold cross-validation</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='no'>ad</span>[<span class='fu'>order</span>(<span class='no'>ad</span>$<span class='no'>block</span>,<span class='no'>ad</span>$<span class='no'>clusterid</span>,<span class='no'>ad</span>$<span class='no'>dataid</span>,<span class='no'>ad</span>$<span class='no'>childid</span>),]

<span class='co'>#Unadjusted permutation test of Bangladesh diarrheal disease outcome.</span>

<span class='co'># Hypothesis 1 permutation tests (Intervention arms vs. control arms)</span>
<span class='fu'>set.seed</span>(<span class='fl'>242524</span>)
<span class='no'>permute.C.W</span> <span class='kw'>&lt;-</span> <span class='fu'>washb_permute</span>(<span class='kw'>Y</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>diar7d</span>,<span class='kw'>tr</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>pair</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>block</span>,<span class='kw'>contrast</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Water"</span>),<span class='kw'>nreps</span><span class='kw'>=</span><span class='fl'>100000</span>)</div><div class='output co'>#&gt; 
#&gt; 	Approximative Wilcoxon-Pratt Signed-Rank Test
#&gt; 
#&gt; data:  y by x (pos, neg) 
#&gt; 	 stratified by block
#&gt; Z = 0.87119, p-value = 0.3862
#&gt; alternative hypothesis: true mu is not equal to 0
#&gt; </div><div class='input'><span class='no'>permute.C.S</span> <span class='kw'>&lt;-</span> <span class='fu'>washb_permute</span>(<span class='kw'>Y</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>diar7d</span>,<span class='kw'>tr</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>pair</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>block</span>,<span class='kw'>contrast</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Sanitation"</span>),<span class='kw'>nreps</span><span class='kw'>=</span><span class='fl'>100000</span>)</div><div class='output co'>#&gt; 
#&gt; 	Approximative Wilcoxon-Pratt Signed-Rank Test
#&gt; 
#&gt; data:  y by x (pos, neg) 
#&gt; 	 stratified by block
#&gt; Z = 3.551, p-value = 0.00036
#&gt; alternative hypothesis: true mu is not equal to 0
#&gt; </div><div class='input'><span class='no'>permute.C.H</span> <span class='kw'>&lt;-</span> <span class='fu'>washb_permute</span>(<span class='kw'>Y</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>diar7d</span>,<span class='kw'>tr</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>pair</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>block</span>,<span class='kw'>contrast</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Handwashing"</span>),<span class='kw'>nreps</span><span class='kw'>=</span><span class='fl'>100000</span>)</div><div class='output co'>#&gt; 
#&gt; 	Approximative Wilcoxon-Pratt Signed-Rank Test
#&gt; 
#&gt; data:  y by x (pos, neg) 
#&gt; 	 stratified by block
#&gt; Z = 3.4504, p-value = 0.00045
#&gt; alternative hypothesis: true mu is not equal to 0
#&gt; </div><div class='input'><span class='no'>permute.C.WSH</span> <span class='kw'>&lt;-</span> <span class='fu'>washb_permute</span>(<span class='kw'>Y</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>diar7d</span>,<span class='kw'>tr</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>pair</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>block</span>,<span class='kw'>contrast</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"WSH"</span>),<span class='kw'>nreps</span><span class='kw'>=</span><span class='fl'>100000</span>)</div><div class='output co'>#&gt; 
#&gt; 	Approximative Wilcoxon-Pratt Signed-Rank Test
#&gt; 
#&gt; data:  y by x (pos, neg) 
#&gt; 	 stratified by block
#&gt; Z = 2.6451, p-value = 0.00753
#&gt; alternative hypothesis: true mu is not equal to 0
#&gt; </div><div class='input'><span class='no'>permute.C.N</span>   <span class='kw'>&lt;-</span> <span class='fu'>washb_permute</span>(<span class='kw'>Y</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>diar7d</span>,<span class='kw'>tr</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>pair</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>block</span>,<span class='kw'>contrast</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Nutrition"</span>),<span class='kw'>nreps</span><span class='kw'>=</span><span class='fl'>100000</span>)</div><div class='output co'>#&gt; 
#&gt; 	Approximative Wilcoxon-Pratt Signed-Rank Test
#&gt; 
#&gt; data:  y by x (pos, neg) 
#&gt; 	 stratified by block
#&gt; Z = 3.0269, p-value = 0.00214
#&gt; alternative hypothesis: true mu is not equal to 0
#&gt; </div><div class='input'><span class='no'>permute.C.NWSH</span> <span class='kw'>&lt;-</span> <span class='fu'>washb_permute</span>(<span class='kw'>Y</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>diar7d</span>,<span class='kw'>tr</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>pair</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>block</span>,<span class='kw'>contrast</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Nutrition + WSH"</span>),<span class='kw'>nreps</span><span class='kw'>=</span><span class='fl'>100000</span>)</div><div class='output co'>#&gt; 
#&gt; 	Approximative Wilcoxon-Pratt Signed-Rank Test
#&gt; 
#&gt; data:  y by x (pos, neg) 
#&gt; 	 stratified by block
#&gt; Z = 3.7068, p-value = 0.00009
#&gt; alternative hypothesis: true mu is not equal to 0
#&gt; </div><div class='input'>
<span class='co'># put objects in the standard format</span>
<span class='no'>h1res</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='no'>permute.C.W</span>,<span class='no'>permute.C.S</span>,<span class='no'>permute.C.H</span>,<span class='no'>permute.C.WSH</span>,<span class='no'>permute.C.N</span>,<span class='no'>permute.C.NWSH</span>)
<span class='no'>diar_h1_pval_unadj</span> <span class='kw'>&lt;-</span> <span class='fu'>as.matrix</span>(<span class='fu'>sapply</span>(<span class='no'>h1res</span>,<span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>p.value</span>),<span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>6</span>)
<span class='fu'>rownames</span>(<span class='no'>diar_h1_pval_unadj</span>) <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"Water v C"</span>,<span class='st'>"Sanitation v C"</span>,<span class='st'>"Handwashing v C"</span>,<span class='st'>"WSH v C"</span>,<span class='st'>"Nutrition v C"</span>,<span class='st'>"Nutrition + WSH v C"</span>)

<span class='co'># print results</span>
<span class='no'>diar_h1_pval_unadj</span></div><div class='output co'>#&gt;                        [,1]
#&gt; Water v C           0.38623
#&gt; Sanitation v C      0.00036
#&gt; Handwashing v C     0.00045
#&gt; WSH v C             0.00753
#&gt; Nutrition v C       0.00214
#&gt; Nutrition + WSH v C 0.00009</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Andrew Mertens, Ben Arnold.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

