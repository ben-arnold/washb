<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generalized linear model function for the WASH Benefits study — washb_glm • washb</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Generalized linear model function for the WASH Benefits study — washb_glm" />

<meta property="og:description" content="Estimate intention-to-treat parameters with generalized linear models and robust standard errors" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">washb</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/washb.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generalized linear model function for the WASH Benefits study</h1>
    
    <div class="hidden name"><code>washb_glm.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Estimate intention-to-treat parameters with generalized linear models and robust standard errors</p>
    
    </div>

    <pre class="usage"><span class='fu'>washb_glm</span>(<span class='no'>Y</span>,<span class='no'>tr</span>,<span class='no'>pair</span>,<span class='kw'>W</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>forcedW</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>V</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>id</span>,<span class='no'>contrast</span>,<span class='kw'>family</span><span class='kw'>=</span><span class='st'>"gaussian"</span>, <span class='kw'>pval</span><span class='kw'>=</span><span class='fl'>0.2</span>, <span class='kw'>print</span><span class='kw'>=</span><span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>Outcome variable (continuous, such as LAZ, or binary, such as diarrhea)</p></td>
    </tr>
    <tr>
      <th>tr</th>
      <td><p>Binary treatment group variable (ideally a factor), comparison group first</p></td>
    </tr>
    <tr>
      <th>pair</th>
      <td><p>Pair-matched randomization ID variable (in WASH Benefits: block)</p></td>
    </tr>
    <tr>
      <th>W</th>
      <td><p>Optional data frame that includes adjustment covariates (for adjusted estimates)</p></td>
    </tr>
    <tr>
      <th>forcedW</th>
      <td><p>Optional vector of variable names to force as adjustment covariates (no screening)</p></td>
    </tr>
    <tr>
      <th>V</th>
      <td><p>Optional variable name for subgroup analyses, which is interacted with 'tr'.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>ID variable for independent units (cluster ID)</p></td>
    </tr>
    <tr>
      <th>contrast</th>
      <td><p>Vector of length 2 that includes the groups to contrast, e.g., c("Control","Water")</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>GLM model family (gaussian, binomial, poisson, and negative binomial). Use "binonial(link='log')" to return prevalence ratios instead of odds ratios when the outcome is binary.  Use "neg.binom" for a Negative binomial model.</p></td>
    </tr>
    <tr>
      <th>pval</th>
      <td><p>The p-value threshold: any variables with a p-value from the lielihood ratio test below this threshold will be returned. Defaults to 0.2</p></td>
    </tr>
    <tr>
      <th>print</th>
      <td><p>Logical for whether to print function output, defaults to TRUE.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical for whether to print names and descriptions of returned list objects</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a list of the risk ratios or risk differences, the variance-covariance matrix, and a vector indexing the rows of observations
        used to fit the glm model</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>washb_glm</code> fits a generalized linear model to estimate intention-to-treat (ITT) effects in a trial. The <code>contrast</code> argument enables you to specify the arms that you wish to compare (reference group in the first argument, comparison group in the second). To estimate adjusted effects, you can pass a data.frame of adjustment covariates to the <code>W</code> argument -- by default, covariates are pre-screened to only include those that are associated with the outcome based on a likelihood ratio test. To over-ride the pre-screening algorithm for some or all covariates, use the <code>forcedW</code> argment.</p>
<p>If the design is pair-matched (all primary outcome analyses in WASH B should be pair matched), use the <code>pair</code> argument to specify an id variable for pairs, and specify the same variable in the id argument to get correct SEs. If the design is not pair-matched, then the id argument should identify the smallest independent unit in the trial (e.g., cluster). The function computes robust standard errors. Note that this function automatically drops observations from the analysis if they are from a pair with no treatment contrast -- this can happen with incomplete randomization blocks in the Kenya trial.</p>
<p>Note that for binary outcomes such as diarrhea, the glm model is fit with a log link,
 <code>family=binomial(link='log')</code>, to estimate prevalence ratios rather than the canonical logit link, <code>family='binomial'</code>,
 to estimate the odds ratio. Occasionally, a glm model with a non-canonical link function like <code>family=binomial(link='log')</code> will fail to converge, particularly if the data are sparse.
 If this occurs, use a modified poisson regression to estimate prevalence ratio using the argument <code>family=poisson(link='log')</code>.
 See Zou 2004 (https://www.ncbi.nlm.nih.gov/pubmed/15033648) for details.</p>
<p>The function also makes it straight forward to estimate conditional (i.e., subgroup) effects using the optional <code>V</code> argument.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>#washb_glm function applied to the Bangladesh diarrheal disease outcome to determine both unadjusted and adjusted</span>
<span class='co'>#prevalence ratios between intervention and control arms.</span>


<span class='co'>#Cleans and merge the enrollment and diarrhea data:</span>
<span class='fu'>library</span>(<span class='no'>washb</span>)

<span class='fu'>data</span>(<span class='no'>washb_bangladesh_enrol</span>)
<span class='no'>washb_bangladesh_enrol</span> <span class='kw'>&lt;-</span> <span class='no'>washb_bangladesh_enrol</span>

<span class='fu'>data</span>(<span class='no'>washb_bangladesh_diar</span>)
<span class='no'>washb_bangladesh_diar</span> <span class='kw'>&lt;-</span> <span class='no'>washb_bangladesh_diar</span>

<span class='co'># drop svydate and month because they are superceded in the child level diarrhea data</span>
<span class='co'>#washb_bangladesh_enrol &lt;- NULL</span>
<span class='co'>#washb_bangladesh_enrol &lt;- NULL</span>

<span class='co'># merge the baseline dataset to the follow-up dataset</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>merge</span>(<span class='no'>washb_bangladesh_enrol</span>,<span class='no'>washb_bangladesh_diar</span>,<span class='kw'>by</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"dataid"</span>,<span class='st'>"clusterid"</span>,<span class='st'>"block"</span>,<span class='st'>"tr"</span>),<span class='kw'>all.x</span><span class='kw'>=</span><span class='no'>F</span>,<span class='kw'>all.y</span><span class='kw'>=</span><span class='no'>T</span>)

<span class='co'># subset to the relevant measurement</span>
<span class='co'># Year 1 or Year 2</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,<span class='no'>svy</span><span class='kw'>==</span><span class='fl'>1</span><span class='kw'>|</span><span class='no'>svy</span><span class='kw'>==</span><span class='fl'>2</span>)

<span class='co'>#subset the diarrhea to children &lt;36 mos at enrollment</span>
<span class='co'>### (exlude new births that are not target children)</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,<span class='no'>sibnewbirth</span><span class='kw'>==</span><span class='fl'>0</span>)
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,<span class='no'>gt36mos</span><span class='kw'>==</span><span class='fl'>0</span>)

<span class='co'># Exclude children with missing data</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>ad</span>,!<span class='fu'>is.na</span>(<span class='no'>ad</span>$<span class='no'>diar7d</span>))

<span class='co'>#Re-order the tr factor for convenience</span>
<span class='no'>ad</span>$<span class='no'>tr</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>levels</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Water"</span>,<span class='st'>"Sanitation"</span>,<span class='st'>"Handwashing"</span>,<span class='st'>"WSH"</span>,<span class='st'>"Nutrition"</span>,<span class='st'>"Nutrition + WSH"</span>))

<span class='co'>#Ensure that month is coded as a factor</span>
<span class='no'>ad</span>$<span class='no'>month</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>ad</span>$<span class='no'>month</span>)

<span class='co'>#Sort the data for perfect replication when using V-fold cross-validation</span>
<span class='no'>ad</span> <span class='kw'>&lt;-</span> <span class='no'>ad</span>[<span class='fu'>order</span>(<span class='no'>ad</span>$<span class='no'>block</span>,<span class='no'>ad</span>$<span class='no'>clusterid</span>,<span class='no'>ad</span>$<span class='no'>dataid</span>,<span class='no'>ad</span>$<span class='no'>childid</span>),]

<span class='co'>###Create vector of contrasts for each hypothesis to facilitate comparisons between arms.</span>
<span class='co'>#Hypothesis 1: Each intervention arm vs. Control</span>
<span class='no'>h1.contrasts</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(
  <span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Water"</span>),
  <span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Sanitation"</span>),
  <span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Handwashing"</span>),
  <span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"WSH"</span>),
  <span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Nutrition"</span>),
  <span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Nutrition + WSH"</span>)
)



<span class='co'>###Unadjusted GLM estimates for diarrheal disease outcome.</span>
<span class='co'>#As an example, the following code applies the washb_glm function to compare 7-day recall diarrheal disease prevalence between the sanitation and control arms. Notice that the glm model is fit with a log link, `family=binomial(link='log')`, to estimate prevalence ratios rather than with a logit link, `family="binomial"`, to estimate the odds ratio.</span>

<span class='no'>Diar.glm.C.S</span> <span class='kw'>&lt;-</span> <span class='fu'>washb_glm</span>(<span class='kw'>Y</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>diar7d</span>,<span class='kw'>tr</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>tr</span>,<span class='kw'>pair</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>block</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>ad</span>$<span class='no'>clusterid</span>, <span class='kw'>contrast</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Control"</span>,<span class='st'>"Sanitation"</span>), <span class='kw'>family</span><span class='kw'>=</span><span class='fu'>binomial</span>(<span class='kw'>link</span><span class='kw'>=</span><span class='st'>'log'</span>))</div><div class='output co'>#&gt; 
#&gt; 
#&gt; -----------------------------------------
#&gt;  GLM Fit: Sanitation vs. Control 
#&gt; -----------------------------------------
#&gt;                     PR      2.5%     97.5%   Estimate Std. Error   z value
#&gt; trSanitation 0.6109162 0.4677257 0.7979433 -0.4927955  0.1362642 -3.616472
#&gt;                  Pr(&gt;|z|)
#&gt; trSanitation 0.0002986455</div><div class='input'>
#On top of the function's auto-printed output, the washb_glm function contains a number of objects. For example, `'objectname'$vcv` returns the variance-covariance matrix.


#All returned objects are:
#'objectname$fit` to return full glm model estimates.
#'objectname$vcv` to return the variance-covariance matrix.
#'objectname$rowdropped` to return the vector list of observations included in the model fit.
#'objectname$lincom` to return subgroup-specific conditional relative risk estimates if a subgroup V is specified.
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Andrew Mertens, Ben Arnold.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

